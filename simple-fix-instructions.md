# Simple Database Fix Instructions

This approach uses a simpler method to fix the Type column issue without relying on custom migrations.

## What This Approach Does

1. **Drops the existing database** to start fresh
2. **Creates a new database** and applies migrations up to (but not including) the problematic one
3. **Applies custom SQL** directly to fix the Type column
4. **Marks problematic migrations as applied** in the migration history
5. **Applies the remaining migrations**

## Files Included

1. **simple-fix.bat**: Windows batch script to run the entire process
2. **simple-fix.ps1**: PowerShell script with the same functionality
3. **fix-type-column.sql**: SQL script that will be generated by the scripts

## How to Use

### Option 1: Using the PowerShell Script (Recommended)

1. Open PowerShell in the backend directory
2. Run the PowerShell script:
   ```
   .\simple-fix.ps1
   ```

### Option 2: Using the Batch Script

1. Open a command prompt in the backend directory
2. Run the batch script:
   ```
   .\simple-fix.bat
   ```

### Option 3: Manual Steps

If you prefer to run the steps manually:

1. Drop the existing database:
   ```
   dotnet ef database drop --force
   ```

2. Create a new database and apply migrations up to the problematic one:
   ```
   dotnet ef database update 20250513012432_UpdateCustomPackagePrice
   ```

3. Run the SQL in `fix-type-column.sql` using pgAdmin

4. Apply the remaining migrations:
   ```
   dotnet ef database update
   ```

## How It Works

This approach:

1. Applies all migrations up to the problematic one
2. Uses custom SQL to fix the Type column:
   ```sql
   ALTER TABLE "Scope" 
   ALTER COLUMN "Type" TYPE integer 
   USING CASE 
       WHEN "Type" = 'Global' THEN 0
       WHEN "Type" = 'Store' THEN 1
       WHEN "Type" = 'Terminal' THEN 2
       ELSE 0 -- Default to Global if unknown
   END;
   ```
3. Marks the problematic migrations as applied in the migration history
4. Applies the remaining migrations

This is simpler than the custom migration approach because it doesn't require creating new migration files.

## Troubleshooting

If you encounter any issues:

1. **Check the output messages** for any errors
2. **Verify your database connection details** are correct
3. **Make sure you have the necessary permissions** to drop and create databases

If you don't have PostgreSQL command-line tools (psql), the script will generate the SQL file for you, and you can run it manually using pgAdmin.
